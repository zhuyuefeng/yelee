title: NOTES—TAS应用中间件
date: '2019-08-27 14:12:50'
tags: [TAS, 中间件]
categories: [工作笔记]
---

&emsp;&emsp;TAS是我司研发的一款企业级中间件产品，和Tomcat类似；它实现了可视化发布标准war包应用程序、配置数据数据源、修改服务器配置、维护用户列表、管理集群等功能，相较于Tomcat管理功能强大；

<!-- more -->

## TAS集群配置

### TAS Loadbalancer服务器

&emsp;&emsp;在安装TAS服务器时，可以选择安装独立的TAS服务器，也可以选择安装TAS     Loadbalancer服务器。
+ TAS Loadbalancer服务器用于搭建集群环境，是一个前端负载均衡器，在TAS Loadbalancer服务器中集成了Apache httpd服务器用于接收请求并转发到集群中的TAS服务器。
+ TAS集群控制台，TAS集群控制台用于管理TAS服务器集群和集成的Apache httpd服务器。TAS集群控制台通过远程总线和集群中的TAS服务器通信，在通信过程中需要提供TAS服务器中合法的用户信息。
+ 有三种部署方式：独立部署、简单集群部署、复杂集群部署

> 与Tomcat集群比较
不需要再去下载安装Apache httpd服务器、以及mod_jk 连接模块，集成过程更加简单方便

### 安装步骤
1、根据机器性能安装一个或多个TAS服务器，安装一个或多个TAS Loadbalancer服务器;
2、在每个TAS Loadbalancer服务器上配置TAS服务器列表（上面安装的独立的TAS服务器）;
3、更新应用程序映射表建立应用程序到TAS服务器之间的映射关系;
4、重新启动集成的Apache httpd服务器，并测试相关的应用程序能否正确访问;

### 启动与控制台访问
+ 启动方式和Tomcat类似，在安装文件的bin目录下，点击`.bat`或`.sh`文件进行启停
+ TAS Loadbalancer服务器和TAS服务器 控制台的访问地址不同;
TAS Loadbalancer服务器:`http://<host>:<port>/tas-lb`,界面如下：

![](/img/集群管理控制台.png)

TAS服务器:`http://<host>:<port>/tas-console`，界面如下：

![](/img/TAS管理控制台.png)

## 解析具体步骤

### 步骤1-安装服务器

&emsp;&emsp;服务启动安装有三种选择，这边只用到了前两种；

![](/img/安装选择.png)

> 值的注意的是：每种安装的端口设置不同；如果安装在一台服务器上，则需要修改端口，以避免端口冲突。(最好记录下来，端口太多)

### 步骤2-配置TAS服务器列表

&emsp;&emsp;在集群管理控台左侧，有`服务器列表`菜单，点击会弹出如下界面：

![](/img/服务器列表.png)

点击`添加服务器`按钮，显示如下：

![](/img/添加服务器列表.png)

+ 服务器标识格式为字母和数字的组合，在提交表单时，系统会验证服务器标识是否唯一。
+ IP地址这里需要填写的是IPv4的格式。
+ 管理端口是远程总线将使用的端口，也就是安装TAS时，所填写的远程管理端口。
+ 管理用户名应是TAS服务器中存在的用户，在远程登录时，不要求这个用户具有任何角色。
+ 管理密码是必填项，用明文显示的。
+ 负载权重是集群属性，是1-100之间的正整数，值越大，则这个TAS服务器处理的请求数越多。
> 在安装目录/webapps/tas-lb/WEB-INF /tas-cluster.xml文件里，可以看到所有添加的服务信息

### 步骤3-更新应用程序映射表
&emsp;&emsp;在集群管理控台左侧，有`http服务器`菜单，点击会弹出如下界面：

![](/img/http服务器.png)

+ 在该界面点击“修改http服务器”按钮可以设置http连接端口和ssl连接端口，点击“配置缓存”按钮可以进行缓存配置
+ 集群信息部分上部包含两个按钮，分别是：“修改集群配置”和“更新TAS服务器和应用程序映射表”。点击“修改集群配置”可修改 session 粘滞、session 粘滞失败处理方式；
+ 更新TAS服务器和应用程序映射表后，需要重新启动集成的Apache httpd服务器才能生效；

> httpd的服务名如下：
![](/img/http服务名.png)

+ TAS服务器个数和应用程序个数。点击“详情”链接，可以查看具体的TAS服务器或应用程序信息；
+ 在TAS服务器个数和应用程序个数后面都有“详情”连接，可以查看详细配置；

## 集群运行监控
&emsp;&emsp;此模块通过图形的方式实时监控集群的运行状态，动态的生成集群的拓扑图，并能显示每个应用程序的路由情况，当有的TAS服务器失效时，会给出提示信息。主监控页面如下所示：

![](/img/运行监控（对）.png)

![](/img/运行监控（错）.png)

## 其他补充

### httpd服务配置文件

+ `httpd.conf`是apache httpd服务器的主配置文件，里面包含监听端口号信息，还包含proxy模块配置信息。
+ `proxy.conf`，这个是proxy模块的配置文件，里面定义了TAS服务器实例信息和负载均衡信息。
+ `cache.conf`，这个是缓存模块的配置文件。

### 更新应用程序映射表
&emsp;&emsp;大体上分三步：
+ 第一步：测试每个TAS服务器的连接状态
+ 第二步：读取每个TAS服务器中部署的应用程序
+ 第三步：建立应用程序映射表，并保存到配置文件
更新的配置文件有：proxy.conf，如果上面步骤中的任何一步出现错误，更新过程都会失败。

### 集群转发策略
+ 根据负载均衡权重值和各服务器处理的请求数转发请求
+ 根据负载均衡权重值和各服务器网络流量转发请求优先选择网络状况较好的服务器
+ 策略优先根据负载均衡权重值进行转发，负载均衡权重值相同的转发到请求数较少的TAS服务器。
+ 策略优先转发到网络状态较好的TAS服务器，网络状态相同的情况下根据负载均衡权重值进行转发。
